<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-white min-h-screen">
    <!-- Thin black banner with right-aligned buttons -->
    <header class="bg-black text-white" style="height:42px;">
        <div class="max-w-7xl mx-auto h-full flex items-center justify-between">
            <div class="flex items-center h-full">
                <a href="/" class="h-full flex items-center px-6 bg-white text-black font-semibold transition-colors duration-150 hover:bg-black hover:text-white">ARCHIVE</a>
            </div>
            <div class="flex items-center h-full">
                <a href="/register" class="h-full flex items-center px-6 bg-white text-black font-semibold transition-colors duration-150 hover:bg-black hover:text-white">REGISTER</a>
                <a href="/signin" class="h-full flex items-center px-6 bg-white text-black font-semibold border-l border-black transition-colors duration-150 hover:bg-black hover:text-white">ACCOUNT</a>
            </div>
        </div>
    </header>

    <!-- Landing area with photo tiles - fills viewport below header -->
    <main id="tiles-container" class="w-full overflow-y-auto" style="height: calc(100vh - 42px);">
        <div id="tiles" class="w-full grid gap-0" style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>
    </main>

    <script>
        (function(){
            function computeAndFill() {
                const container = document.getElementById('tiles');
                container.innerHTML = '';
                const viewportWidth = document.documentElement.clientWidth;
                const minTile = 240; // minimum tile size
                const cols = Math.max(1, Math.floor(viewportWidth / minTile));
                const tileWidth = Math.floor(viewportWidth / cols);
                const availableHeight = document.documentElement.clientHeight - 42; // subtract header
                const rows = Math.max(1, Math.ceil(availableHeight / tileWidth));
                const total = rows * cols;

                for (let i = 0; i < total; i++) {
                    let tile;
                    if (i === 0) {
                        // Greensleeves Sampler tile
                        tile = document.createElement('div');
                        tile.className = 'group relative overflow-hidden';
                        tile.style.backgroundColor = '#222';
                        tile.style.aspectRatio = '1 / 1';
                        tile.style.display = 'flex';
                        tile.style.alignItems = 'center';
                        tile.style.justifyContent = 'center';

                        // Album image: try local static SVG first (no DB). If it fails, fall back to embedded SVG.
                        const img = document.createElement('img');
                        img.alt = 'Greensleeves Sampler (cover)';
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.objectFit = 'cover';
                        img.style.transition = 'filter 220ms ease';
                        // try server-side proxy first (avoids CORS/hotlinking issues), then static SVG, then embedded SVG
                        img.src = '/static/proxy/greensleeves';
                        img.onerror = function() {
                            // try the local static SVG
                            if (img.src !== '/static/images/greensleeves.svg') {
                                img.src = '/static/images/greensleeves.svg';
                                return;
                            }
                            // fallback to embedded SVG data-uri
                            const svgCover = '<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600">'
                                + '<rect width="100%" height="100%" fill="#0b0b0b"/>'
                                + '<circle cx="300" cy="240" r="160" fill="#d6d6d6" opacity="0.12"/>'
                                + '<text x="50%" y="54%" fill="#ffffff" font-size="28" font-family="Arial, Helvetica, sans-serif" font-weight="700" dominant-baseline="middle" text-anchor="middle">Various</text>'
                                + '<text x="50%" y="64%" fill="#ffffff" font-size="20" font-family="Arial, Helvetica, sans-serif" dominant-baseline="middle" text-anchor="middle">Greensleeves Sampler</text>'
                                + '</svg>';
                            img.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(svgCover);
                            img.onerror = null;
                        };
                        tile.appendChild(img);

                        const overlay = document.createElement('div');
                        overlay.className = 'absolute inset-0';
                        overlay.style.background = 'rgba(0,0,0,0)';
                        overlay.style.transition = 'background 220ms ease';
                        tile.appendChild(overlay);

                        const content = document.createElement('div');
                        content.className = 'absolute inset-0 flex flex-col items-center justify-center';
                        content.style.opacity = '0';
                        content.style.transition = 'opacity 220ms ease';
                        content.style.color = 'white';

                        const title = document.createElement('div');
                        title.textContent = 'Various â€“ Greensleeves Sampler';
                        title.style.fontWeight = '700';
                        title.style.fontSize = '1rem';
                        content.appendChild(title);

                        const btn = document.createElement('a');
                        btn.textContent = 'INFO';
                        btn.href = 'https://www.discogs.com/release/7549711-Various-Greensleeves-Sampler';
                        btn.target = '_blank';
                        btn.style.marginTop = '8px';
                        btn.className = 'bg-white text-black px-3 py-1 rounded';
                        content.appendChild(btn);

                        tile.appendChild(content);

                        tile.addEventListener('mouseenter', () => {
                            if (img && img.complete) img.style.filter = 'grayscale(100%) brightness(40%)';
                            overlay.style.background = 'rgba(0,0,0,0.35)';
                            content.style.opacity = '1';
                        });
                        tile.addEventListener('mouseleave', () => {
                            if (img) img.style.filter = 'none';
                            overlay.style.background = 'rgba(0,0,0,0)';
                            content.style.opacity = '0';
                        });

                        container.appendChild(tile);
                    } else {
                        const shade = ["#ffffff","#f8f4f8","#e5e5e5","#bfbfbf","#808080","#404040","#000000"][i % 7];
                        tile = document.createElement('div');
                        tile.className = 'group relative overflow-hidden';
                        tile.style.backgroundColor = shade;
                        tile.style.aspectRatio = '1 / 1';
                        tile.style.display = 'flex';
                        tile.style.alignItems = 'center';
                        tile.style.justifyContent = 'center';

                        const overlay = document.createElement('div');
                        overlay.className = 'absolute inset-0';
                        overlay.style.background = 'rgba(0,0,0,0)';
                        overlay.style.transition = 'background 200ms';
                        tile.appendChild(overlay);

                        const content = document.createElement('div');
                        content.className = 'absolute inset-0 flex flex-col items-center justify-center';
                        content.style.opacity = '0';
                        content.style.transition = 'opacity 200ms';
                        content.style.color = 'white';

                        const title2 = document.createElement('div');
                        title2.style.fontWeight = '700';
                        title2.style.fontSize = '1rem';

                        if (i === 1) {
                            title2.textContent = 'RECORD';
                            content.appendChild(title2);

                            const ribbon = document.createElement('div');
                            // ribbon left intentionally without visible text
                            ribbon.textContent = '';
                            ribbon.style.position = 'absolute';
                            ribbon.style.top = '8px';
                            ribbon.style.right = '-36px';
                            ribbon.style.background = '#dc2626';
                            ribbon.style.color = 'white';
                            ribbon.style.padding = '4px 48px';
                            ribbon.style.transform = 'rotate(45deg)';
                            ribbon.style.fontWeight = '700';
                            ribbon.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
                            tile.appendChild(ribbon);

                            const btn2 = document.createElement('button');
                            btn2.textContent = 'SALE';
                            btn2.style.marginTop = '8px';
                            btn2.className = 'bg-red-600 text-white px-3 py-1 rounded';
                            content.appendChild(btn2);
                        } else if (i === 2) {
                            title2.textContent = 'RECORD';
                            content.appendChild(title2);

                            const ribbon = document.createElement('div');
                            // ribbon left intentionally without visible text
                            ribbon.textContent = '';
                            ribbon.style.position = 'absolute';
                            ribbon.style.top = '8px';
                            ribbon.style.right = '-36px';
                            ribbon.style.background = '#2563eb';
                            ribbon.style.color = 'white';
                            ribbon.style.padding = '4px 44px';
                            ribbon.style.transform = 'rotate(45deg)';
                            ribbon.style.fontWeight = '700';
                            ribbon.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
                            tile.appendChild(ribbon);

                            const btn2 = document.createElement('button');
                            btn2.textContent = 'SOLD';
                            btn2.style.marginTop = '8px';
                            btn2.className = 'bg-blue-600 text-white px-3 py-1 rounded';
                            content.appendChild(btn2);
                        } else {
                            title2.textContent = 'RECORD';
                            content.appendChild(title2);

                            const btn2 = document.createElement('button');
                            btn2.textContent = 'INFO';
                            btn2.style.marginTop = '8px';
                            btn2.className = 'bg-white text-black px-3 py-1 rounded';
                            content.appendChild(btn2);
                        }

                        tile.appendChild(content);

                        tile.addEventListener('mouseenter', () => {
                            overlay.style.background = 'rgba(0,0,0,0.5)';
                            content.style.opacity = '1';
                        });
                        tile.addEventListener('mouseleave', () => {
                            overlay.style.background = 'rgba(0,0,0,0)';
                            content.style.opacity = '0';
                        });

                        container.appendChild(tile);
                    }
                }
            }

            // Floating CONTACT button (fixed bottom-right)
            (function addContactButton(){
                const existing = document.getElementById('floating-contact');
                if (existing) return;
                const btn = document.createElement('a');
                btn.id = 'floating-contact';
                btn.href = '/contact';
                btn.textContent = 'CONTACT';
                btn.className = 'fixed bottom-6 right-6 bg-black text-white px-4 py-2 rounded shadow-lg hover:bg-white hover:text-black transition-colors duration-150';
                btn.style.zIndex = '1000';
                document.body.appendChild(btn);
            })();

            // Recompute on load and resize
            window.addEventListener('load', computeAndFill);
            window.addEventListener('resize', () => {
                // debounce
                clearTimeout(window.__tileResize);
                window.__tileResize = setTimeout(computeAndFill, 120);
            });

            // expose for debugging
            window.computeAndFill = computeAndFill;
        })();
    </script>
</body>
</html>